<!doctype html>
<html lang="en">
  <head>
  <title>Stardog 2.2.1 Docs: Security</title>
  <script src="/js/libs/modernizr-2.6.2.min.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-Powered-By" content="DocPad v6.44.0">
  <link rel="stylesheet" href="/css/gumby.css">
  <!--     //a block for ipad, etc... might should go in meta -->
  </head>

<body>
<!--
  <div class="" id="the-content">
    <div class="wrapper shaded" id="topblock">
    <div class="row">
      <div class="four columns">
        <a href="/"><img class="resrc" src="http://app.resrc.it/S=H55/R=L/http://docs.stardog.com/img/logotype.png"/></a>
      </div>
      <div class="eight columns">
        
      </div>
    </div>
  </div>
-->
<div id="page-wrap">
 <div id="the-content">
  <div id="theborder" class="wrapper">
    <!-- full bleed top border styling.... -->
      <div class="twelve columns"></div>
  </div>

    <div class="row">
        <div class="four columns stretch-container" id="sidebar1">
          <nav id="sidebar-nav-holder" class="fixed vertical-nav stretch-y" gumby-fixed="top">
            <div id="sidebar-logo">
              <a id="a52" style="text-decoration: none; background-color: none; border: none; color: none;" href="http://stardog.com/">
                <img id="thelogo" src="http://docs.stardog.com/img/sd.png">       
              </a>
            </div>
            
              <!-- 
	<h3 id="tochead">Security Contents</h3>
 -->

<ul class="sidebar-nav">
    
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-The-Stardog-Security-Model" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-The-Stardog-Security-Model">
            <strong>The Stardog Security Model</strong>
        </a>
        <!-- <li><a href="#sd-The-Stardog-Security-Model" class="skiplink">The Stardog Security Model</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-Managing-Stardog-Securely" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-Managing-Stardog-Securely">
            <strong>Managing Stardog Securely</strong>
        </a>
        <!-- <li><a href="#sd-Managing-Stardog-Securely" class="skiplink">Managing Stardog Securely</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-Deploying-Stardog-Securely" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-Deploying-Stardog-Securely">
            <strong>Deploying Stardog Securely</strong>
        </a>
        <!-- <li><a href="#sd-Deploying-Stardog-Securely" class="skiplink">Deploying Stardog Securely</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-Securing-Stardog-on-Linux" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-Securing-Stardog-on-Linux">
            <strong>Securing Stardog on Linux</strong>
        </a>
        <!-- <li><a href="#sd-Securing-Stardog-on-Linux" class="skiplink">Securing Stardog on Linux</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    

</ul>
              <p id="tocnav">
              
                <a class="iconlinks" href="/"><i style="padding-left:0px; margin-left:0px;" class="icon-home iconlinks"></i></a>&nbsp;
              
              <a href="#" id="" class="skip iconlinks" gumby-easing="easeInOutQuad" gumby-goto="top" gumby-duration="2000">
                <i style="padding-left:0px; margin-left:0px;" class="icon-publish iconlinks"></i>
              </a> &nbsp;
              <a href="https://twitter.com/stardog_db" class="iconlinks">
                <i style="padding-left:0px; margin-left:0px;" class="icon-twitter iconlinks"></i>
              </a>
              </p>
            
          </nav>
        </div>

        <div class="eight columns">
          <!-- woof! -->
            <div class="row">
              <p id="quote"><em><strong>Every program has (at least) two purposes: the one for which it was written, and another for which it wasn't.</strong></em>&mdash;Alan Perlis, <cite>Epigrams in Programming</cite></p>
              <div class="pull_left"><h1 id="title-subhead">Security</h1></div>
            </div>
          <!-- summary -->
          
          <div id="mdblock">
            <h2 id="sd-The-Stardog-Security-Model">The Stardog Security Model</h2>
<p>Stardog's security model is based on standard role-based access control: users have <em>permissions</em> over <em>resources</em>; permissions can be grouped into roles; and roles can be assigned to users. Stardog uses <a href="http://shiro.apache.org/">Apache Shiro</a> for authentication, authorization, and session management and <a href="http://www.mindrot.org/projects/jBCrypt/">jBCrypt</a> for password hashing. </p>
<h3>Resources</h3>
<p>A resource is some Stardog entity or service to which access is to be
controlled. Resources are identified by their <em>type</em> and their <em>name</em>. A
particular resource is denoted as <code>type_prefix:name</code>. The valid resource
types with their prefixes are shown below.</p>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Prefix</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>User</td>
<td><code>user</code></td>
<td>A user (e.g., <code>user:admin</code>)</td>
</tr>
<tr>
<td>Role</td>
<td><code>role</code></td>
<td>A role assigned to a user (<code>role:reader</code>)</td>
</tr>
<tr>
<td>Database</td>
<td><code>db</code></td>
<td>A database (<code>db:myDB</code>)</td>
</tr>
<tr>
<td>Database Metadata</td>
<td><code>metadata</code></td>
<td>Metadata of a database (<code>metadata:myDB</code>)</td>
</tr>
<tr>
<td>Database Admin</td>
<td><code>admin</code></td>
<td>Database admin tasks (e.g., <code>admin:myDB</code>)</td>
</tr>
<tr>
<td>Integrity Constraints</td>
<td><code>icv-constraints</code></td>
<td>Integrity constraints associated with a database (e.g., <code>icv-constraints:myDB</code>)</td>
</tr>
</tbody>
</table>
<h3>Permissions</h3>
<p>Permissions are composed of a <em>permission subject</em>, an <em>action</em>, and a
<em>permission object</em>, which is interpreted as the subject resource can perform the
specified action over the object resource.</p>
<p>Permission subjects can be of type <code>user</code> or <code>role</code> only. Permission
objects can be of any valid type. Valid actions include the following:</p>
<p><code>read</code>
:   Permits reading the resource properties</p>
<p><code>write</code>
:   Permits changing the resource properties</p>
<p><code>create</code>
:   Permits creating new resources</p>
<p><code>delete</code>
:   Permits deleting a resource</p>
<p><code>grant</code>
:   Permits granting permissions over a resource</p>
<p><code>revoke</code>
:   Permits revoking permissions over a resource</p>
<p><code>execute</code>
:   Permits executing administration actions over a database</p>
<p><code>all</code>
:   Special action type that permits all previous actions over a resource</p>
<h3>Wildcards</h3>
<p>Stardog understands the use of wildcards to represent sets of resources. A
wildcard is denoted with the character <code>*</code>. Wildcards can be used to
create complex permissions; for instance, we can give a user the ability
to create any database by granting it a <code>create</code> permission over <code>db:*</code>.
Similarly, wildcards can be used in order to revoke multiple permissions
simultaneously.</p>
<h3>Superusers</h3>
<p>It is possible at (user) creation time to specify that a given user is a superuser. Being a superuser is equivalent to having been granted an <code>all</code>
permission over <code>*:*</code>. Therefore, as expected, superusers are allowed to
perform any valid action over any existing resource.</p>
<h3>Database Owner Default Permissions</h3>
<p>When a user creates a resource, it is automatically granted <code>delete</code>,
<code>write</code>, <code>read</code>, <code>grant</code>, and <code>revoke</code> permissions over the new
resource. If the new resource is a database, then the user is
additionally granted <code>write</code>, <code>read</code>, <code>grant</code>, and <code>revoke</code> permissions
over <code>icv-constraints:theDatabase</code>, and <code>execute</code> permission over
<code>admin:theDatabase</code>. These latter two permissions give the creator of the
database the ability to administer the ICV constraints for the database
and to administer the database itself.</p>
<h3>Default Security Configuration</h3>
<div class="metro danger label">Security Notice</div>

<p>Out of the box, the Stardog security setup is minimal and <em>most importantly</em> <strong>insecure</strong>:</p>
<ul>
<li><code>user:admin</code> with password set to “admin” is a superuser.</li>
<li><code>user:anonymous</code> with password “anonymous” has the “reader” role.</li>
<li><code>role:reader</code> allows to <code>read</code> from any resource.</li>
</ul>
<h3>Setting Password Constraints</h3>
<p>To setup the constraints used to validate passwords when adding new users, configure the following settings in the <code>stardog.properties</code> configuration file.</p>
<ul>
<li><code>password.length.min</code>: Sets the password policy for the minimum length of 
user passwords, the value can't be less than 1 or greater than <code>password.length.max</code>. 
Default: <code>4</code>.</li>
<li><code>password.length.max</code>: Sets the password policy for the maximum length of 
user passwords, the value can't be greater than 1024 or less than 1. Default: <code>20</code>.</li>
<li><code>password.regex</code>: Sets the password policy of accepted chars in user passwords, via a 
Java regular expression. Default: <code>[\\w@#$%]+</code></li>
</ul>
<h3>Using a Password File</h3>
<p>To avoid putting passwords into scripts or environment variables, you can put them into a suitable secured password file. If no credentials are passed explicitly in CLI invocations or you do not ask Stardog to prompt you for credentials interactively, then it will look for credentials in a password file. On a Unix system, Stardog will look for a file called <code>.sdpass</code> the home directory of the user Stardog is running as; on a Windows system, it will look for <code>sdpass.conf</code> in <code>Application Data\stardog</code> in the home directory of the user Stardog is running as. If the file is not found in this location, Stardog will look in the location provided by the <code>stardog.passwd.file</code> system property.</p>
<h4>Password File Format</h4>
<p>The format of the password file is as follows:</p>
<ul>
<li>any line that starts with a <code>#</code> is ignored</li>
<li>each line contains a single password in the format: <code>hostname:port:database:username:password</code>.</li>
<li>wildcards, <code>*</code>, are permitted for any field but the password field; colons and backslashes in fields are escaped with <code>\</code>.</li>
</ul>
<p>For example,</p>
<pre class="highlighted"><code class="bash">  <span class="comment">#this is my password file; there are no others like it and this one is mine anyway...</span>
  *:*:*:flannery:aNahthu8
  *:*:summercamp:jemima:foh9Moaz</code></pre>
<p>Of course you should secure this file carefully, making sure that only the user that Stardog runs as can read it.</p>
<h2 id="sd-Managing-Stardog-Securely">Managing Stardog Securely</h2>
<p>Stardog resources can be managed securely by using the tools included in the admin CLI or by programming against Stardog APIs. In this section we describe the permissions required to manage various Stardog resources either by CLI or API.</p>
<h3>Users</h3>
<p>Create a user
:   <code>create</code> permission over <code>user:*</code>. Only superusers can create other superusers.</p>
<p>Delete a user
:   <code>delete</code> permission over the user.</p>
<p>Enable/Disable a user
:   User must be a superuser.</p>
<p>Change password of a user
:   User must be a superuser or user must be trying to change its own password.</p>
<p>Check if a user is a superuser
:   <code>read</code> permission over the user or user must be trying to get its own info.</p>
<p>Check if a user is enabled
:   <code>read</code> permission over the user or user must be trying to get its own info.</p>
<p>List users
:   Superusers can see all users. Other users can see only users over which they have a permission.</p>
<h3>Roles</h3>
<p>Create a role
:   <code>create</code> permission over <code>role:*</code>.</p>
<p>Delete a role
:   <code>delete</code> permission over the role.</p>
<p>Assign a role to a user
:   <code>grant</code> permission over the role <strong>and</strong> user must have all the permissions associated to the role.</p>
<p>Unassign a role from a user
:   <code>revoke</code> permission over the role <strong>and</strong> user must have all the permissions associated to the role.</p>
<p>List roles
:   Superusers can see all roles. Other users can see only roles they have been assigned or over which they have a permission.</p>
<h3>Databases</h3>
<p>Create a database
:   <code>create</code> permission over <code>db:*</code>.</p>
<p>Delete a database
:   <code>delete</code> permission over <code>db:theDatabase</code>.</p>
<p>Add/Remove integrity constraints to a database
:   <code>write</code> permission over <code>icv-constraints:theDatabase</code>.</p>
<p>Verify a database is valid with respect to its integrity constraints
:   <code>read</code> permission over <code>icv-constraints:theDatabase</code>.</p>
<p>Online/Offline a database
:   <code>execute</code> permission over <code>admin:theDatabase</code>.</p>
<p>Migrate a database
:   <code>execute</code> permission over <code>admin:theDatabase</code>.</p>
<p>Optimize a database
:   <code>execute</code> permission over <code>admin:theDatabase</code>.</p>
<p>List databases
:   Superusers can see all databases. Regular users can see only databases over which they have a permission.</p>
<h3>Permissions</h3>
<p>Grant a permission
:   <code>grant</code> permission over the permission object <strong>and</strong> user must have the permission that it is trying to grant.</p>
<p>Revoke a permission from a user or role over an object resource
:   <code>revoke</code> permission over the permission object <strong>and</strong> user must have the permission that it is trying to revoke.</p>
<p>List user permissions
:   User must be a superuser or user must be trying to get its own info.</p>
<p>List role permissions
:   User must be a superuser or user must have been assigned the role.</p>
<h2 id="sd-Deploying-Stardog-Securely">Deploying Stardog Securely</h2>
<p>To ensure that Stardog's RBAC access control implementation will be
effective, all non-administrator access to Stardog databases should
occur over network (i.e., non-native) database connections.<a id="fn-ref-1" href="#footnote-1" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-1"><sup>1</sup></a></p>
<p>To ensure the confidentiality of user
authentication credentials when using remote connections, the Stardog
server should only accept connections that are secured with SSL. This
section describes how Stardog can be configured to use SSL for data
confidentiality and server authentication. It does not address using SSL
for client authentication.<a id="fn-ref-2" href="#footnote-2" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-2"><sup>2</sup></a></p>
<h3>Configuring Stardog to use SSL</h3>
<p>Stardog 2.2.1's HTTP server includes native support for SSL. The SNARL server (via <code>snarls://</code>) also supports SSL. Stardog may also be deployed securely using two other methods:</p>
<ul>
<li>HTTPS reverse proxying; and </li>
<li>SSL-enabled application server.</li>
</ul>
<p>However, in many cases, it‘s just easier to use Stardog’s native SSL support.</p>
<p>To enable Stardog to optionally support SSL connections, just pass <code>--enable-ssl</code> to the server start command.  If you want to require the server to only use SSL, that is, to reject any non-SSL connections, then use <code>--require-ssl</code>.</p>
<p>When starting from the command line, Stardog will use the standard Java properties for specifying keystore information:</p>
<ul>
<li><code>javax.net.ssl.keyStorePassword</code>  (the password)</li>
<li><code>javax.net.ssl.keyStore</code> (location of the keystore)</li>
<li><code>javax.net.ssl.keyStoreType</code> (type of keystore, defaults to JKS)</li>
</ul>
<p>These properties are checked first in <code>stardog.properties</code>; then in JVM args passed in from the command line, eg <code>-Djavax.net.ssl.keyStorePassword=mypwd</code>. If you're creating a Server progammatically via <code>ServerBuilder</code>, you can specify values for these properties using the appropriate <code>ServerOptions</code> when creating the server.  These values will override anything specified in <code>stardog.properties</code> or via normal JVM args.</p>
<h4>HTTPS Reverse Proxying</h4>
<p>An HTTPS reverse proxy<a id="fn-ref-3" href="#footnote-3" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-3"><sup>3</sup></a> may be used to secure Stardog client-server connections if the Stardog server is run using the command-line tool or deployed as a servlet. In
the following two sections, we describe how to use <a href="">Apache</a> and
<a href="">lighttpd</a> as HTTPS reverse proxies for Stardog. These configurations
can be used for new reverse proxy deployments or can be modified to
augment existing reverse proxies with SSL. Of course other solutions may
be used; these are illustrative of the general technique and approach.</p>
<p>In this approach, the network connection between Stardog
clients and the proxy server is secured using SSL. But the connection
between the proxy server and Stardog server is insecure; thus, <strong>care
should be taken to ensure that proxy-Stardog connections only occur over
trusted networks.</strong></p>
<p>Note also that non-SSL connections to the Stardog
server from hosts other than the proxy server should be prohibited in
order to prevent network exposure of user credentials and data. Stardog's
default HTTP server listens on all host interfaces and accepts all
connections. If it is used, then a host-based firewall is necessary to
prohibit connections from servers other than the proxy server.</p>
<p>HTTPS reverse proxying depends on having a certificate and private key
on the proxy server. A cheap and easy deployment strategy is to use a
self-signed certificate. Creating such a certificate is documented
elsewhere and not repeated here.<a id="fn-ref-4" href="#footnote-4" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-4"><sup>4</sup></a> Alternately, an
SSL cert can be obtained from a commercial certificate authority.</p>
<h5>Reverse Proxy with lighttpd</h5>
<p><a href="http://lighttpd.net">lighttpd</a> can be configured to provide an SSL
layer for remote connections. The following lighttpd configuration file
is a complete example that lets clients use HTTPS connections with the
lighttpd proxy to communicate with a Stardog HTTP server listening on
port 12345 of the lighttpd host.</p>
<pre class="highlighted"><code class="avrasm">server<span class="preprocessor">.port</span> = <span class="number">443</span>
ssl<span class="preprocessor">.engine</span> = <span class="string">"enable"</span>
ssl<span class="preprocessor">.pemfile</span> = <span class="string">"server.pem"</span>
server<span class="preprocessor">.modules</span> = ( <span class="string">"mod_proxy"</span> )
proxy<span class="preprocessor">.server</span> = ( <span class="string">""</span> =&gt; ( ( <span class="string">"host"</span> =&gt; <span class="string">"127.0.0.1"</span> , <span class="string">"port"</span> =&gt; <span class="string">"12345"</span> ) )
              )
server<span class="preprocessor">.document</span>-root = <span class="string">"/dev/null"</span></code></pre>
<p>This configuration directs lighttpd to use the certificate and private
key in server.pem for SSL connections.<a id="fn-ref-5" href="#footnote-5" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-5"><sup>5</sup></a></p>
<h5>Reverse Proxy with Apache 2</h5>
<p>Apache httpd can be configured to provide an SSL layer for remote
connections. The following partial configuration file<a id="fn-ref-6" href="#footnote-6" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-6"><sup>6</sup></a> allows clients to use
HTTPS connections with the Apache proxy, which communicates with a
Stardog HTTP server listening on port 12345 of the Apache host.</p>
<pre class="highlighted"><code class="apache"><span class="keyword">SSLEngine</span>                 <span class="literal">On</span>
<span class="keyword">SSLCertificateFile</span>        server.pem
<span class="tag">&lt;Directory /&gt;</span> <span class="keyword">SSLRequireSSL</span> <span class="tag">&lt;/Directory&gt;</span>
<span class="keyword">ProxyPass</span>        /        http://127.0.0.1:12345/</code></pre>
<p>This configuration depends on the SSL certificate and private key being
located in the <code>server.pem</code> file in the Apache server root. It also
depends on <code>mod_ssl</code>, <code>mod_proxy</code>, and <code>mod_proxy_http</code> modules being
compiled into the httpd binary or loaded via directives elsewhere in the
configuration file.</p>
<h4>SSL-Enabled App Server</h4>
<p>Stardog may also be deployed as a servlet in a container or app server that can provide SSL support. For example, if Stardog is deployed into a default Resin Server,<a id="fn-ref-7" href="#footnote-7" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-7"><sup>7</sup></a>
then the following configuration would enable SSL on the server using
the certificate and private key stored in the Java KeyStore at
<code>server-keystore.jks</code>.</p>
<pre class="highlighted"><code class="xml"><span class="tag">&lt;<span class="title">http</span> <span class="attribute">address</span>=<span class="value">"*"</span> <span class="attribute">port</span>=<span class="value">"443"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">jsse-ssl</span>&gt;</span>
                <span class="tag">&lt;<span class="title">key-store-file</span>&gt;</span>server-keystore.jks<span class="tag">&lt;/<span class="title">key-store-file</span>&gt;</span>
                <span class="tag">&lt;<span class="title">password</span>&gt;</span>********<span class="tag">&lt;/<span class="title">password</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">jsse-ssl</span>&gt;</span>
<span class="tag">&lt;/<span class="title">http</span>&gt;</span></code></pre>
<p>Other Java app servers support SSL including GlassFish, Tomcat, and
JBoss. The configuration of SSL for each application server is
implementation specific; consult the relevant server’s
documentation.</p>
<h3>Configuring Stardog Client to use SSL</h3>
<p>Stardog HTTP client supports SSL when the <code>https:</code>
scheme is used in the database connection string; likewise, it uses SSL for SNARL when the connection string uses the <code>snarls:</code> scheme. For example, the
following invocation of the Stardog command line utility will initiate
an SSL connection to a remote database:</p>
<pre class="highlighted"><code class="avrasm">$ stardog status -c https://stardog<span class="preprocessor">.example</span><span class="preprocessor">.org</span>/sp2b_10k</code></pre>
<p>If the client is unable to authenticate to the server, then the connection
will fail and an error message like the following will be generated.</p>
<pre class="highlighted"><code class="coffeescript">Error during connect.  Cause was <span class="attribute">SSLPeerUnverifiedException</span>: peer <span class="keyword">not</span> authenticated</code></pre>
<p>The most common cause of this error is that the server presented a
certificate that was not issued by an authority that the client trusts.
The Stardog HTTP client driver uses standard Java security components to
access a store of trusted certificates. By default, it trusts a list of
certificates installed with the Java runtime environment, but it can be
configured to use a custom trust store.<a id="fn-ref-8" href="#footnote-8" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-8"><sup>8</sup></a></p>
<p>The client driver can be directed to use a specific Java KeyStore file
as a trust store by setting the <code>javax.net.ssl.trustStore</code> system
property. To address the authentication error above, that trust store
should contain the issuer of the server’s certificate. Standard Java tools can create such a file. The following invocation of the <code>keytool</code> utility creates a new trust store named <code>my-truststore.jks</code> and
initializes it with the certificate in <code>my-trusted-server.crt</code>. The tool
will prompt for a passphrase to associate with the trust store. This is
not used to encrypt its contents, but can be used to ensure its
integrity.<a id="fn-ref-9" href="#footnote-9" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-9"><sup>9</sup></a></p>
<pre class="highlighted"><code class="lasso">$ keytool <span class="attribute">-importcert</span>  <span class="attribute">-keystore</span> my<span class="attribute">-truststore</span>.jks \
        <span class="attribute">-alias</span> stardog<span class="attribute">-server</span> <span class="attribute">-file</span> my<span class="attribute">-trusted</span><span class="attribute">-server</span>.crt</code></pre>
<p>The following Stardog command line invocation uses the newly created
truststore.</p>
<pre class="highlighted"><code class="avrasm">$ STARDOG_JAVA_ARGS=”-Djavax<span class="preprocessor">.net</span><span class="preprocessor">.ssl</span><span class="preprocessor">.trustStore</span>=my-truststore<span class="preprocessor">.jks</span>” \
        stardog status -c https://stardog<span class="preprocessor">.example</span><span class="preprocessor">.org</span>/sp2b_10k</code></pre>
<p>For custom Java applications that use the Stardog HTTP client driver,
the system property can be set programmatically or when the JVM is
initialized.</p>
<p>The most common deployment approach requiring a custom trust store is
when a self-signed certificate is presented by the Stardog server. For
connections to succeed, the Stardog client must trust the self-signed
certificate. To accomplish this with the examples given above, the
self-signed certificate should be in the <code>my-trusted-server.crt</code> file in
the keytool invocation.</p>
<p>A client may also fail to authenticate to the server if the hostname in the
Stardog database connection string does not match a name contained in
the server certificate.<a id="fn-ref-10" href="#footnote-10" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-10"><sup>10</sup></a></p>
<p>This will cause an error message like the following</p>
<pre class="highlighted"><code class="vbnet"><span class="keyword">Error</span> during connect.  Cause was SSLException: hostname <span class="keyword">in</span> certificate didn<span class="comment">'t match</span></code></pre>
<p>The client driver does not support connecting when there's a mismatch;
therefore, the only workarounds are to replace the server’s certificate or
modify the connection string to use an alias for the same server that
matches the certificate.</p>
<h2 id="sd-Securing-Stardog-on-Linux">Securing Stardog on Linux</h2>
<p>This section describes one approach to installing Stardog on Linux—or
another Unix-like operating system—with the goal of restricting
unauthorized access to Stardog data. The approach detailed below is not
the only effective way to secure a Stardog installation. Stardog
administrators should customize their installation for the requirements
of their environment.</p>
<p>In what follows, you'll see snippets of shell code. For each snippet, <code>$</code>
represents the shell prompt and <code>\</code> is the line continuation character.
Some of the shell snippets make use of relative paths and are intended
to be run from within directory where Stardog release file was unzipped.
Many of the snippets will need to be run with elevated permissions.</p>
<div class="metro danger label">Security Notice</div>

<p>Make sure that you know what you're doing before you copy any of the
snippets of shell code or configuration syntax into a real Linux system. We trust us and you probably should trust us; that said, <em>trust but verify</em>. <em>You've been warned.</em></p>
<h3>Creating A Basic Stardog Environment</h3>
<p>The Stardog library files should be copied from the distribution
directory into a permanent location in the host system—we're big fans of the <code>/opt</code>—and—<code>/var</code> approach, but your needs may vary. The snippet
below chooses a common location and uses a versioning string to
facilitate parallel installs of different Stardog releases. An
administrator may choose any location.</p>
<pre class="highlighted"><code class="ruby"><span class="variable">$ </span>export <span class="constant">STARDOG_VERSION</span>=<span class="variable">@@VERSION</span>@@
<span class="variable">$ </span>export <span class="constant">STARDOG_LIBDIR</span>=<span class="regexp">/opt/stardog</span>-<span class="variable">${</span><span class="constant">STARDOG_VERSION</span>}/lib
<span class="variable">$ </span>install -d <span class="variable">${</span><span class="constant">STARDOG_LIBDIR</span>}
<span class="variable">$ </span>cp -r lib/* <span class="variable">${</span><span class="constant">STARDOG_LIBDIR</span>}
<span class="variable">$ </span>chown -<span class="constant">R</span> <span class="symbol">root:</span>root <span class="variable">${</span><span class="constant">STARDOG_LIBDIR</span>}
<span class="variable">$ </span>chmod -<span class="constant">R</span> a+r <span class="variable">${</span><span class="constant">STARDOG_LIBDIR</span>}</code></pre>
<p>The Stardog command line tools should be copied from the distribution
directory into a location that places them into most users’ execution
<code>PATH</code>. Execution permissions to the tools are <em>not</em> limited because
access to the data directory will be <strong>strictly limited</strong>.</p>
<pre class="highlighted"><code class="lasso">$ install <span class="attribute">-c</span> <span class="attribute">-m</span> a=<span class="literal">rx</span> ./stardog /usr/bin/stardog
$ install <span class="attribute">-c</span> <span class="attribute">-m</span> a=<span class="literal">rx</span> ./stardog<span class="attribute">-admin</span> /usr/sbin/stardog<span class="attribute">-admin</span></code></pre>
<p>The Stardog data directory stores both user data and system
configuration data, <strong>including access control information</strong>. The location
selected for the data directory should be reliable, large enough to meet
data requirements, and secured from unauthorized access.</p>
<pre class="highlighted"><code class="coffeescript">$ <span class="reserved">export</span> STARDOG_HOME=/<span class="reserved">var</span>/db/stardog</code></pre>
<p>Access to the data directory is limited to the <code>stardog</code> group and the
only member of that group is the <code>stardog</code> user.Granting access
permissions to members of the <code>stardog</code> group is more flexible than
limiting access to a single user. For example, it may allow a Stardog
network server to run as a user other than <code>stardog</code>; or it may
facilitate other processes other than Stardog, i.e., data backup. The
snippet below creates that user and group.</p>
<pre class="highlighted"><code class="bash">$ groupadd stardog
$ useradd <span class="operator">-d</span> <span class="variable">${STARDOG_HOME}</span> \
          -g stardog \
          <span class="operator">-s</span> /sbin/nologin \
stardog</code></pre>
<p>This snippet creates the data directory and limits its access to the
newly created group.</p>
<pre class="highlighted"><code class="brainfuck"><span class="comment">$</span> <span class="comment">install</span> <span class="literal">-</span><span class="comment">d</span> <span class="literal">-</span><span class="comment">o</span> <span class="comment">stardog</span> <span class="literal">-</span><span class="comment">g</span> <span class="comment">stardog</span> <span class="literal">-</span><span class="comment">m</span> <span class="comment">ug=rwx</span>,<span class="comment">o=${STARDOG_HOME}</span></code></pre>
<p>Note that if a Stardog server is used to allow network access to remote
Stardog clients, then the approach described here requires the server to
run as a user in the <code>stardog</code> group.</p>
<p>An administrator can accomplish this by running the server as the
<code>stardog</code> user or by adding the relevant user to the <code>stardog</code> group.
For example, the following snippet adding the <code>tomcat</code> user to the
<code>stardog</code> group may be needed in an environment where a Stardog HTTP
server is run as an application within Tomcat.</p>
<pre class="highlighted"><code class="lasso">$ usermod -<span class="attribute">-add</span><span class="attribute">-to</span><span class="attribute">-group</span> stardog tomcat</code></pre>
<p>Of course the ideal deployment of the Stardog server depends on the
particulars of the deployment environment, the preferences of the
administrator, and the anticipated user load. The group-based permission
approach provides flexibility to satisfy many alternatives.</p>

          </div>
          <div class="" id="footnote-container" style="display: block;">
            <h2>Notes</h2>
          <div class="footnote" id="footnote-1"><p>1. In other words, embedded Stardog access is inherently <em>insecure</em> and should be used accordingly.<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-1">&nbsp;&#8618;</a></p></div><div class="footnote" id="footnote-2"><p>2. Stardog 2.2.1 does not support client authentication using X.509 certificates instead of passphrases.<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-2">&nbsp;&#8618;</a></p></div><div class="footnote" id="footnote-3"><p>3.  Reverse proxying may be useful beyond SSL
layering—it may be used to distribute load across multiple Stardog
servers. For general documentation of reverse proxying with lighttpd,
see <a href="http://redmine.lighttpd.net/wiki/lighttpd/Docs:ModProxy">the fine documentation</a>;
likewise for <a href="http://httpd.apache.org/docs/2.2/mod/mod_proxy.html#forwardreverse">Apache</a>.<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-3">&nbsp;&#8618;</a></p></div><div class="footnote" id="footnote-4"><p>4. For example, see <a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/Security6.html">the
example</a>
creating a certificate with the Java keytool; or <a href="http://www.openssl.org/docs/apps/req.html">an
example</a> generating a self
signed root certificate using the openssl req tool.<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-4">&nbsp;&#8618;</a></p></div><div class="footnote" id="footnote-5"><p>5. lighttpd can be configured to
present chaining certificates with the server certificate. This may be
necessary if the server certificate is not directly signed by a trusted
authority, but chains to a trusted authority. For details on this
configuration see <a href="http://redmine.lighttpd.net/wiki/lighttpd/Docs:SSL">the docs</a> (the
ssl.ca-file option).<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-5">&nbsp;&#8618;</a></p></div><div class="footnote" id="footnote-6"><p>6. A complete
configuration file is not provided because the minimal configuration
file required by Apache is more detailed than the configuration file
required by lighttpd.The configuration directives shown are those
necessary to enable SSL and reverse proxying.<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-6">&nbsp;&#8618;</a></p></div><div class="footnote" id="footnote-7"><p>7. See <a href="http://caucho.com/resin/">Resin</a> for more info; it supports SSL using
JSSE in the open source version and using OpenSSL in the professional
version. Resin’s SSL support is <a href="http://www.caucho.com/resin-4.0/admin/security-ssl.xtp">well
documented</a>.<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-7">&nbsp;&#8618;</a></p></div><div class="footnote" id="footnote-8"><p>8. The Stardog HTTP client driver uses an X509TrustManager. The details of how a trust store is selected to initialize the trust manager are
<a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#X509TrustManager">described in the docs</a>.<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-8">&nbsp;&#8618;</a></p></div><div class="footnote" id="footnote-9"><p>9. See the <code>javax.net.ssl.trustStorePassword</code> system property
<a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#X509TrustManager">documentation</a>.<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-9">&nbsp;&#8618;</a></p></div><div class="footnote" id="footnote-10"><p>10. The matching algorithm used is <a href="http://hc.apache.org/httpcomponents-client-ga/tutorial/html/connmgmt.html">described</a>
in the Apache docs about <code>BrowserCompatHostnameVerifier</code>.<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-10">&nbsp;&#8618;</a></p></div></div>
        </div>
    </div>
  </div>
</div>


<div class="wrapper shaded" id="subfoot">
      <section class="row">
        <div class="twelve columns">
            <div class="four columns">
              <a style="text-decoration: none; border-bottom: 0;" href="http://clarkparsia.com/"><img id="footer-logo" style="max-width: 50%;" src="/img/cp.png"></a>
              <div> </div>
              <!-- follow us on Twitter -->
            </div>
            <div class="eight columns">
              
                <h4>This is <span id="footer-subhead">Security</span>, part of <a href="http://docs.stardog.com/">Stardog Docs</a> 2.2.1.</h4>
              
              <p class="copywood">For comments, questions, or to report problems with this page, visit the <a href="https://groups.google.com/a/clarkparsia.com/group/stardog/about">Stardog Support Forum</a>.</p>
              <p class="copywood">&copy;2010&ndash;2014 Clark &amp; Parsia LLC. <a href="http://creativecommons.org/licenses/by-sa/3.0/">Some rights reserved</a>.
            </p></div>
        </div>
      </section>
</div>

<script defer="defer" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script defer="defer" src="/js/libs/gumby.js"></script><script defer="defer" src="/js/libs/ui/gumby.fittext.js"></script><script defer="defer" src="/js/libs/ui/gumby.fixed.js"></script><script defer="defer" src="/js/libs/ui/gumby.navbar.js"></script><script defer="defer" src="/js/libs/ui/gumby.retina.js"></script><script defer="defer" src="/js/libs/ui/gumby.skiplink.js"></script><script defer="defer" src="/js/libs/ui/gumby.tabs.js"></script><script defer="defer" src="/js/libs/ui/gumby.toggleswitch.js"></script><script defer="defer" src="/js/libs/gumby.init.js"></script><script defer="defer" src="/js/plugins.js"></script><script defer="defer" src="/js/main.js"></script>

</body>

</html>