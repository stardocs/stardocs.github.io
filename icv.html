<!doctype html>
<html lang="en">
  <head>
  <title>Stardog 2.2 Docs: Integrity Constraint Validation</title>
  <script src="/js/libs/modernizr-2.6.2.min.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-Powered-By" content="DocPad v6.44.0">
  <link rel="stylesheet" href="/css/gumby.css">
  <!--     //a block for ipad, etc... might should go in meta -->
  </head>

<body>
<!--
  <div class="" id="the-content">
    <div class="wrapper shaded" id="topblock">
    <div class="row">
      <div class="four columns">
        <a href="/"><img class="resrc" src="http://app.resrc.it/S=H55/R=L/http://docs.stardog.com/img/logotype.png"/></a>
      </div>
      <div class="eight columns">
        
      </div>
    </div>
  </div>
-->
<div id="page-wrap">
 <div id="the-content">
  <div id="theborder" class="wrapper">
    <!-- full bleed top border styling.... -->
      <div class="twelve columns"></div>
  </div>

    <div class="row">
        <div class="four columns stretch-container" id="sidebar1">
          <nav id="sidebar-nav-holder" class="fixed vertical-nav stretch-y" gumby-fixed="top">
            <div id="sidebar-logo">
              <a id="a52" style="text-decoration: none; background-color: none; border: none; color: none;" href="http://stardog.com/">
                <img id="thelogo" src="http://docs.stardog.com/img/sd.png">       
              </a>
            </div>
            
              <!-- 
	<h3 id="tochead">Integrity Constraint Validation Contents</h3>
 -->

<ul class="sidebar-nav">
    
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-Introduction" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-Introduction">
            <strong>Introduction</strong>
        </a>
        <!-- <li><a href="#sd-Introduction" class="skiplink">Introduction</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-Getting-Started-with-ICV" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-Getting-Started-with-ICV">
            <strong>Getting Started with ICV</strong>
        </a>
        <!-- <li><a href="#sd-Getting-Started-with-ICV" class="skiplink">Getting Started with ICV</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-ICV-amp--OWL-2-Reasoning" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-ICV-amp--OWL-2-Reasoning">
            <strong>ICV &amp; OWL 2 Reasoning</strong>
        </a>
        <!-- <li><a href="#sd-ICV-amp--OWL-2-Reasoning" class="skiplink">ICV &amp; OWL 2 Reasoning</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-ICV-Examples" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-ICV-Examples">
            <strong>ICV Examples</strong>
        </a>
        <!-- <li><a href="#sd-ICV-Examples" class="skiplink">ICV Examples</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-Explaining-ICV-Violations" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-Explaining-ICV-Violations">
            <strong>Explaining ICV Violations</strong>
        </a>
        <!-- <li><a href="#sd-Explaining-ICV-Violations" class="skiplink">Explaining ICV Violations</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-Using-ICV-Programmatically" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-Using-ICV-Programmatically">
            <strong>Using ICV Programmatically</strong>
        </a>
        <!-- <li><a href="#sd-Using-ICV-Programmatically" class="skiplink">Using ICV Programmatically</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    
    <!-- [data-target='-->
        <li>
            <a href="#sd-Terminology" class="skip" gumby-easing="easeOutQuad" gumby-duration="300" gumby-goto="#sd-Terminology">
            <strong>Terminology</strong>
        </a>
        <!-- <li><a href="#sd-Terminology" class="skiplink">Terminology</a> -->
            
                <ul class="sidebar-nav">
                
    

                </ul>
            
        </li>
    

</ul>
              <p id="tocnav">
              
                <a class="iconlinks" href="/"><i style="padding-left:0px; margin-left:0px;" class="icon-home iconlinks"></i></a>&nbsp;
              
              <a href="#" id="" class="skip iconlinks" gumby-easing="easeInOutQuad" gumby-goto="top" gumby-duration="2000">
                <i style="padding-left:0px; margin-left:0px;" class="icon-publish iconlinks"></i>
              </a> &nbsp;
              <a href="https://twitter.com/stardog_db" class="iconlinks">
                <i style="padding-left:0px; margin-left:0px;" class="icon-twitter iconlinks"></i>
              </a>
              </p>
            
          </nav>
        </div>

        <div class="eight columns">
          <!-- woof! -->
            <div class="row">
              <p id="quote"><em><strong>It is easier to write an incorrect program than understand a correct one.</strong></em>&mdash;Alan Perlis, <cite>Epigrams in Programming</cite></p>
              <div class="pull_left"><h1 id="title-subhead">Integrity Constraint Validation</h1></div>
            </div>
          <!-- summary -->
          
          <div id="mdblock">
            <h2 id="sd-Introduction">Introduction</h2>
<p>Stardog Integrity Constraint Validation (“ICV”) validates RDF data stored in a Stardog database according to data rules (i.e., “constraints”) described by users and that make sense for their domain, application, and data. These constraints are written in SPARQL, OWL, or SWRL. This chapter explains how to use ICV and how it works.</p>
<p>The use of high-level languages (OWL 2, SWRL, and SPARQL) to validate
RDF data using closed world semantics is one of Stardog's unique
capabilities. Using high level languages like OWL, SWRL, and SPARQL as schema or constraint languages for RDF and Linked Data has several advantages:</p>
<ul>
<li>Unifying the domain model with data quality rules</li>
<li>Aligning the domain model and data quality rules with the
integration model and language (i.e., RDF)</li>
<li>Being able to query the domain model, data quality rules,
integration model, mapping rules, etc with SPARQL</li>
<li>Being able to use automated reasoning about all of these things to insure logical consistency, explain errors and problems, etc.</li>
</ul>
<p>If you are also interested in theory and background, please see the <a href="/icv/icv-specification.html">ICV specification</a>, which has all the formal details.</p>
<h2 id="sd-Getting-Started-with-ICV">Getting Started with ICV</h2>
<p>This log of a CLI session gives a full example of how to validate data using a mix of integrity constraints expressed in OWL and SPARQL. It uses data and constraints linked below.</p>
<script src="https://gist.github.com/5612900.js?file=commands.log"></script>

<p> See the following Gists to follow along at home:</p>
<ul>
<li><a href="https://gist.github.com/evren/5612900#file-sota-constraints-ttl">Constraints in OWL</a></li>
<li><a href="https://gist.github.com/evren/5612900#file-sota-data-ttl">Example Data in Turtle</a></li>
<li><a href="https://gist.github.com/evren/5612900#file-sota-example-java">Java Example</a></li>
<li><a href="https://gist.github.com/evren/5612900#file-sota-example-out">Example Output</a></li>
<li><a href="https://gist.github.com/evren/5612900#file-sota-query-example-java">SPARQL Query Example in Java</a></li>
<li><a href="https://gist.github.com/evren/5612900#file-sota-query-out">SPARQL Query Output</a></li>
<li><a href="https://gist.github.com/evren/5612900#file-sota-query-sparql">Constraints in SPARQL</a></li>
</ul>
<p>And, finally, the <a href="https://gist.github.com/evren/5612900">full Gist with links to everything</a>. In the rest of this chapter, we explain in more detail about programmatic access, as well as give a full slate of examples of ICV in action.</p>
<h2 id="sd-ICV-amp--OWL-2-Reasoning">ICV &amp; OWL 2 Reasoning</h2>
<p><strong>An integrity constraint may be satisfied or violated in either of two
ways: by an explicit statement in a Stardog database or by a statement that's been legally inferred by Stardog (because a user requested reasoning).</strong></p>
<p>This means that when ICV is enabled for a Stardog database, it has to be enabled with respect to a reasoning type (which we sometimes call in the Stardog Docs a “reasoning level”). The valid choices of reasoning type are any type or kind of reasoning supported by Stardog. See <a href="/owl2#reasoning-levels">Stardog's reasoning &amp; inference chapter</a> for more.</p>
<p>The implication is that ICV is performed with three inputs:</p>
<ol>
<li>a Stardog database,</li>
<li>a set of constraints, and</li>
<li>a reasoning type (which may be, of course, no reasoning).</li>
</ol>
<p>This is the case because domain modelers, ontology developers, or integrity constraint authors must consider the interactions between explicit and inferred statements and how these are accounted for in integrity constraints.</p>
<h3>Security Implications <div class="metro danger label">Security Notice</div></h3>
<p>There is a security implication in this design choice that may not be
obvious. Changing the reasoning type associated with a database and
integrity constraint validation has serious security implications with
respect to a Stardog database and may only be performed by a user role
with sufficient privileges for that action.</p>
<h2 id="sd-ICV-Examples">ICV Examples</h2>
<p>Rather than discuss the <a href="/icv/icv-specification.html">formal semantics</a> of
ICV here, we will look at some examples. The following examples use <a href="http://www.w3.org/TR/owl2-manchester-syntax/">OWL
2's Manchester syntax</a>; and they assume a simple data schema, which is
available as an <a href="/icv/company.owl">OWL ontology</a> and as a <a href="/icv/ClassDiagram.png">UML diagram</a>. The examples also assume that the default
namespace is <code>&lt;http://example.com/company.owl#&gt;</code> and that <code>xsd:</code> is
bound to the standard, <code>&lt;http://www.w3.org/2001/XMLSchema#&gt;</code>.</p>
<p><a href="https://gist.github.com/1333767">Reference Java code</a> is available for each of
the following examples and is also distributed with Stardog.</p>
<h3>Subsumption Constraints</h3>
<p>This kind of constraint guarantees certain subclass and superclass
(i.e., subsumption) relationships exist between instances.</p>
<h4>Managers must be employees.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Manager</span> <span class="uri">rdfs:subClassOf</span> <span class="uri">:Employee</span></code></pre>
<h5>Database A <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Alice</span> <span class="uri">a</span> <span class="uri">:Manager</span> .</code></pre>
<h5>Database B <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Alice</span> <span class="uri">a</span> <span class="uri">:Manager</span> , <span class="uri">:Employee</span> .</code></pre>
<p>This constraint says that if an RDF individual is an instance of
<code>Manager</code>, then it must also be an instance of <code>Employee</code>. In
A, the only instance of <code>Manager</code>, namely <code>Alice</code>, is not an instance of
<code>Employee</code>; therefore, A is invalid. In B, <code>Alice</code> is an instance of
Database both <code>Manager</code> and <code>Employee</code>; therefore, B is valid.</p>
<h3>Domain-Range Constraints</h3>
<p>These constraints control the types of domain and range instances of
properties.</p>
<h4>Only project leaders can be responsible for projects.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:is_responsible_for</span> <span class="uri">rdfs:domain</span> <span class="uri">:Project_Leader</span></code></pre>
<h5>Database A <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Alice</span> <span class="uri">:is_responsible_for</span> <span class="uri">:MyProject</span> .

<span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> .</code></pre>
<h5>Database B <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Alice</span> <span class="uri">a</span> <span class="uri">:Project_Leader</span> ;
    <span class="uri">:is_responsible_for</span> <span class="uri">:MyProject</span> .</code></pre>
<h5>Database C <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Alice</span> <span class="uri">a</span> <span class="uri">:Project_Leader</span> ;
    <span class="uri">:is_responsible_for</span> <span class="uri">:MyProject</span> .

<span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> .</code></pre>
<p>This constraint says that if two RDF instances are related to each other via the property <code>is_responsible_for</code>, then
the range instance must be an instance of <code>Project_Leader</code> and the domain instance must be an instance of
<code>Project</code>. In Database A, there is only one pair of individuals related
via <code>is_responsible_for</code>, namely <code>(Alice, MyProject)</code>, and <code>MyProject</code>
is an instance of <code>Project</code>; but <code>Alice</code> is not an instance of
<code>Project_Leader</code>. Therefore, A is invalid. In B, <code>Alice</code> is an instance
of <code>Project_Leader</code>, but <code>MyProject</code> is not an instance of <code>Project</code>;
therefore, B is not valid. In C, <code>Alice</code> is an instance of
<code>Project_Leader</code>, and <code>MyProject</code> is an instance of <code>Project</code>;
therefore, C is valid.</p>
<h4>Only employees can have an SSN.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:ssn</span> <span class="uri">rdfs:domain</span> <span class="uri">:Employee</span></code></pre>
<h5>Database A <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Bob</span> <span class="uri">:ssn</span> <span class="string">"123-45-6789"</span> .</code></pre>
<h5>Database B <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Bob</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:ssn</span> <span class="string">"123-45-6789"</span> ..</code></pre>
<p>This constraint says that if an RDF instance <code>i</code> has a data assertion
via the the property <code>SSN</code>, then <code>i</code> must be an instance of <code>Employee</code>.
In A, <code>Bob</code> is not an instance of <code>Employee</code> but
has <code>SSN</code>; therefore, A is invalid. In B, <code>Bob</code> is an
instance of <code>Employee</code>; therefore, B is valid.</p>
<h4>A date of birth must be a date.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:dob</span> <span class="uri">rdfs:range</span> <span class="uri">xsd:date</span></code></pre>
<h5>Database A <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Bob</span> <span class="uri">:dob</span> <span class="string">"1970-01-01"</span> .</code></pre>
<h5>Database B <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Bob</span> <span class="uri">:dob</span> <span class="string">"1970-01-01"</span>^^<span class="uri">xsd:date</span></code></pre>
<p>This constraint says that if an RDF instance <code>i</code> is related to a literal
<code>l</code> via the data property <code>DOB</code>, then <code>l</code> must have the XML Schema type
<code>xsd:date</code>. In A, <code>Bob</code> is related to the untyped literal
<code>"1970-01-01"</code> via <code>DOB</code> so A is invalid. In B, the literal
<code>"1970-01-01"</code> is properly typed so it's valid.</p>
<h3>Participation Constraints</h3>
<p>These constraints control whether or not an RDF instance participates
in some specified relationship.</p>
<h4>Each supervisor must supervise at least one employee.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="comment"># Constraint in Terp syntax:
</span><span class="comment"># :Supervisor rdfs:subClassOf (:supervises some :Employee)
</span>
<span class="uri">:Supervisor</span> <span class="uri">rdfs:subClassOf</span>
              [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                <span class="uri">owl:onProperty</span> <span class="uri">:supervises</span> ;
                <span class="uri">owl:someValuesFrom</span> <span class="uri">:Employee</span>
              ] .</code></pre>
<h5>Database A <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Alice</span> <span class="uri">a</span> <span class="uri">owl:Thing</span> .</code></pre>
<h5>Database B <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Alice</span> <span class="uri">a</span> <span class="uri">:Supervisor</span> .</code></pre>
<h5>Database C <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Alice</span> <span class="uri">a</span> <span class="uri">:Supervisor</span> ;
    <span class="uri">:supervises</span> <span class="uri">:Bob</span> .</code></pre>
<h5>Database D <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Alice</span> <span class="uri">a</span> <span class="uri">:Supervisor</span> ;
    <span class="uri">:supervises</span> <span class="uri">:Bob</span> .

<span class="uri">:Bob</span> <span class="uri">a</span> <span class="uri">:Employee</span></code></pre>
<p>This constraint says that if an RDF instance <code>i</code> is of type
<code>Supervisor</code>, then <code>i</code> must be related to an individual <code>j</code> via the
property <code>supervises</code> and also that <code>j</code> must be an instance of <code>Employee</code>.
In A, <code>Supervisor</code> has no instances; therefore, A is trivially
valid. In B, the only instance of <code>Supervisor</code>, namely <code>Alice</code>, is
related to no individual; therefore, B is invalid. In C, <code>Alice</code> is
related to <code>Bob</code> via <code>supervises</code>, but <code>Bob</code> is not an instance of
<code>Employee</code>; therefore, C is invalid. In D, <code>Alice</code> is related to <code>Bob</code>
via <code>supervises</code>, and <code>Bob</code> is an instance of <code>Employee</code>; hence, D
is valid.</p>
<h4>Each project must have a valid project number.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="comment"># Constraint in Terp syntax:
</span><span class="comment"># :Project rdfs:subClassOf (:number some xsd:integer[&gt;= 0, &lt; 5000])
</span>
<span class="uri">:Project</span> <span class="uri">rdfs:subClassOf</span>
              [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                <span class="uri">owl:onProperty</span> <span class="uri">:number</span> ;
                <span class="uri">owl:someValuesFrom</span>
                        [ <span class="uri">a</span> <span class="uri">rdfs:Datatype</span> ;
                          <span class="uri">owl:onDatatype</span> <span class="uri">xsd:integer</span> ;
                          <span class="uri">owl:withRestrictions</span> ([<span class="uri">xsd:minInclusive</span> <span class="number">0</span>] [ <span class="uri">xsd:maxExclusive</span> <span class="number">5000</span>])
                        ]
              ] .</code></pre>
<h5>Database A <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">owl:Thing</span> .</code></pre>
<h5>Database B <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span></code></pre>
<h5>Database C <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> ;
    <span class="uri">:number</span> <span class="string">"23"</span> .</code></pre>
<h5>Database D <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> ;
    <span class="uri">:number</span> <span class="string">"6000"</span>^^<span class="uri">xsd:integer</span> .</code></pre>
<h5>Database E <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> ;
    <span class="uri">:number</span> <span class="string">"23"</span>^^<span class="uri">xsd:integer</span> .</code></pre>
<p>This constraint says that if an RDF instance <code>i</code> is of type <code>Project</code>,
then <code>i</code> must be related via the property <code>number</code> to an integer between
<code>0</code> and <code>5000</code> (inclusive)—that is, projects have project numbers in a certain range.
In  A, the individual <code>MyProject</code> is
not known to be an instance of <code>Project</code> so the constraint does not
apply at all and A is valid. In B, <code>MyProject</code> is an instance of
<code>Project</code> but doesn't have any data assertions via <code>number</code> so A
is invalid. In C, <code>MyProject</code> does have a data property assertion via
<code>number</code> but the literal <code>"23"</code> is untyped—so it's not an integer—therefore,
C is invalid. In D, <code>MyProject</code> is related to an integer via
<code>number</code> but it is out of the range: D is invalid. Finally,
in E, <code>MyProject</code> is related to the integer <code>23</code> which is in the range
of <code>[0,5000]</code> so E is valid.</p>
<h3>Cardinality Constraints</h3>
<p>These constraints control the number of various relationships or
property values.</p>
<h4>Employees must not work on more than 3 projects.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="comment"># Constraint in Terp syntax:
</span><span class="comment"># :Employee rdfs:subClassOf (:works_on max 3 :Project)
</span>
<span class="uri">:Employee</span> <span class="uri">rdfs:subClassOf</span>
              [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                <span class="uri">owl:onProperty</span> <span class="uri">:works_on</span>;
                <span class="uri">owl:maxQualifiedCardinality</span> <span class="string">"3"</span>^^<span class="uri">xsd:nonNegativeInteger</span> ;
                <span class="uri">owl:onClass</span> <span class="uri">:Project</span>
              ] .</code></pre>
<h5>Database A <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Bob</span> <span class="uri">a</span> <span class="uri">owl:Thing</span>.</code></pre>
<h5>Database B <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Bob</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:works_on</span> <span class="uri">:MyProject</span> .

<span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> .</code></pre>
<h5>Database C <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Bob</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:works_on</span> <span class="uri">:MyProject</span> , <span class="uri">:MyProjectFoo</span> , <span class="uri">:MyProjectBar</span> , <span class="uri">:MyProjectBaz</span> .

<span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> .

<span class="uri">:MyProjectFoo</span> <span class="uri">a</span> <span class="uri">:Project</span> .

<span class="uri">:MyProjectBar</span> <span class="uri">a</span> <span class="uri">:Project</span> .

<span class="uri">:MyProjectBaz</span> <span class="uri">a</span> <span class="uri">:Project</span> .</code></pre>
<p>If an RDF instance <code>i</code> is an <code>Employee</code>, then
<code>i</code> must not be related via the property <code>works_on</code> to more than 3
instances of <code>Project</code>. In  A, <code>Bob</code> is not known
to be an instance of <code>Employee</code> so the constraint does not apply and the
A is valid. In B, <code>Bob</code> is an instance of <code>Employee</code> but is known
to work on only a single project, namely <code>MyProject</code>, so B is
valid. In C, <code>Bob</code> is related to 4 instances of <code>Project</code>
via <code>works_on</code>.</p>
<p>Now, pay attention, because this is important. Stardog ICV implements a weak form of the <em>unique name assumption</em>, that is, it assumes that things which have different names are, in fact, different things.<a id="fn-ref-1" href="#footnote-1" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-1"><sup>1</sup></a> Since Stardog ICV uses closed world (instead of open world) semantics,<a id="fn-ref-2" href="#footnote-2" class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#footnote-2"><sup>2</sup></a> it assumes that the different projects with different names are, in fact, separate projects, which (in this case) violates the constraint and makes C invalid.</p>
<h4>Departments must have at least 2 employees.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="comment"># Constraint in Terp syntax:
</span><span class="comment"># :Department rdfs:subClassOf (inverse :works_in min 2 :Employee)
</span>
<span class="uri">:Department</span> <span class="uri">rdfs:subClassOf</span>
              [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                <span class="uri">owl:onProperty</span> [<span class="uri">owl:inverseOf</span> <span class="uri">:works_in</span>] ;
                <span class="uri">owl:minQualifiedCardinality</span> <span class="string">"2"</span>^^<span class="uri">xsd:nonNegativeInteger</span> ;
                <span class="uri">owl:onClass</span> <span class="uri">:Employee</span>
              ] .</code></pre>
<h5>Database A <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyDepartment</span> <span class="uri">a</span> <span class="uri">owl:NamedIndividual</span> .</code></pre>
<h5>Database B <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyDepartment</span> <span class="uri">a</span> <span class="uri">:Department</span> .

<span class="uri">:Bob</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:works_in</span> <span class="uri">:MyDepartment</span> .</code></pre>
<h5>Database C <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyDepartment</span> <span class="uri">a</span> <span class="uri">:Department</span> .

<span class="uri">:Alice</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:works_in</span> <span class="uri">:MyDepartment</span> .

<span class="uri">:Bob</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:works_in</span> <span class="uri">:MyDepartment</span> .</code></pre>
<p>This constraint says that if an RDF instance <code>i</code> is a <code>Department</code>, then
there should exist at least 2 instances <code>j</code> and <code>k</code> of class <code>Employee</code>
which are related to <code>i</code> via the property <code>works_in</code> (or, equivalently,
<code>i</code> should be related to them via the inverse of <code>works_in</code>). In A,
<code>MyDepartment</code> is not known to be an instance
of <code>Department</code> so the constraint does not apply. In B, <code>MyDepartment</code>
is an instance of <code>Department</code> but only one
instance of <code>Employee</code>, namely <code>Bob</code>, is known to work in it, so the
B is invalid. In C, <code>MyDepartment</code> is related to the individuals
<code>Bob</code> and <code>Alice</code>, which are both instances of <code>Employee</code> and
(again, due to weak Unique Name Assumption in Stardog  ICV), are
assumed to be distinct, so C is valid.</p>
<h4>Managers must manage exactly 1 department.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="comment"># Constraint in Terp syntax:
</span><span class="comment"># :Manager rdfs:subClassOf (:manages exactly 1 :Department)
</span>
<span class="uri">:Manager</span> <span class="uri">rdfs:subClassOf</span>
              [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                <span class="uri">owl:onProperty</span> <span class="uri">:manages</span> ;
                <span class="uri">owl:qualifiedCardinality</span> <span class="string">"1"</span>^^<span class="uri">xsd:nonNegativeInteger</span> ;
                <span class="uri">owl:onClass</span> <span class="uri">:Department</span>
              ] .</code></pre>
<h5>Database A <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql">    Individual: Isabella</code></pre>
<h5>Database B <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Isabella</span> <span class="uri">a</span> <span class="uri">:Manager</span> .</code></pre>
<h5>Database C <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Isabella</span> <span class="uri">a</span> <span class="uri">:Manager</span> ;
    <span class="uri">:manages</span> <span class="uri">:MyDepartment</span> .</code></pre>
<h5>Database D <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Isabella</span> <span class="uri">a</span> <span class="uri">:Manager</span> ;
    <span class="uri">:manages</span> <span class="uri">:MyDepartment</span> .

<span class="uri">:MyDepartment</span> <span class="uri">a</span> <span class="uri">:Department</span> .</code></pre>
<h5>Database E <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Isabella</span> <span class="uri">a</span> <span class="uri">:Manager</span> ;
    <span class="uri">:manages</span> <span class="uri">:MyDepartment</span> , <span class="uri">:MyDepartment1</span> .

<span class="uri">:MyDepartment</span> <span class="uri">a</span> <span class="uri">:Department</span> .

<span class="uri">:MyDepartment1</span> <span class="uri">a</span> <span class="uri">:Department</span> .</code></pre>
<p>This constraint says that if an RDF instance <code>i</code> is a <code>Manager</code>, then it
must be related to exactly 1 instance of <code>Department</code> via the property
<code>manages</code>. In A, the individual <code>Isabella</code> is not known to be
an instance of <code>Manager</code> so the constraint does not apply and the
A is valid. In B, <code>Isabella</code> is an instance of <code>Manager</code> but is
not related to any instances of <code>Department</code>, so B is
invalid. In C, <code>Isabella</code> is related to the individual <code>MyDepartment</code>
via the property <code>manages</code> but <code>MyDepartment</code> is not known to be an
instance of <code>Department</code>, so C is invalid. In D, <code>Isabella</code>
is related to exactly one instance of <code>Department</code>, namely
<code>MyDepartment</code>, so D is valid. Finally, in E, <code>Isabella</code> is
related to 2 distinct (again, because of weak UNA) instances of
<code>Department</code>, namely <code>MyDepartment</code> and <code>MyDepartment1</code>, so E
is invalid.</p>
<h4>Entities may have no more than one name.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:name</span> <span class="uri">a</span> <span class="uri">owl:FunctionalProperty</span> .</code></pre>
<h5>Database A <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyDepartment</span> <span class="uri">a</span> <span class="uri">owl:Thing</span> .</code></pre>
<h5>Database B <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyDepartment</span> <span class="uri">:name</span> <span class="string">"Human Resources"</span> .</code></pre>
<h5>Database C <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyDepartment</span> <span class="uri">:name</span> <span class="string">"Human Resources"</span> , <span class="string">"Legal"</span> .</code></pre>
<p>This constraint says that no RDF instance <code>i</code> can have more than 1
assertion via the data property <code>name</code>. In A, <code>MyDepartment</code> does not have any data property assertions so A is valid.
In B, <code>MyDepartment</code> has a single assertion via <code>name</code>, so the ontology
is also valid. In C, <code>MyDepartment</code> is related to 2 literals, namely
<code>"Human Resources"</code> and <code>"Legal"</code>, via <code>name</code>, so C is
invalid.</p>
<h3>Property Constraints</h3>
<p>These constraints control how instances are related to one another via
properties.</p>
<h4>The manager of a department must work in that department.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:manages</span> <span class="uri">rdfs:subPropertyOf</span> <span class="uri">:works_in</span> .</code></pre>
<h5>Database A <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Bob</span> <span class="uri">:manages</span> <span class="uri">:MyDepartment</span></code></pre>
<h5>Database B <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Bob</span> <span class="uri">:works_in</span> <span class="uri">:MyDepartment</span> ;
    <span class="uri">:manages</span> <span class="uri">:MyDepartment</span> .</code></pre>
<p>This constraint says that if an RDF instance <code>i</code> is related to <code>j</code> via
the property <code>manages</code>, then <code>i</code> must also be related to <code>j</code> va the
property <code>works_in</code>. In A, <code>Bob</code> is related to <code>MyDepartment</code>
via <code>manages</code>, but not via <code>works_in</code>, so A is invalid. In
B, <code>Bob</code> is related to <code>MyDepartment</code> via both <code>manages</code> and
<code>works_in</code>, so B is valid.</p>
<h4>Department managers must supervise all the department's employees.</h4>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:is_supervisor_of</span> <span class="uri">owl:propertyChainAxiom</span> (<span class="uri">:manages</span> [<span class="uri">owl:inverseOf</span> <span class="uri">:works_in</span>]) .</code></pre>
<h5>Database A <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Jose</span> <span class="uri">:manages</span> <span class="uri">:MyDepartment</span> ;
    <span class="uri">:is_supervisor_of</span> <span class="uri">:Maria</span> .

<span class="uri">:Maria</span> <span class="uri">:works_in</span> <span class="uri">:MyDepartment</span> .

<span class="uri">:Diego</span> <span class="uri">:works_in</span> <span class="uri">:MyDepartment</span> .</code></pre>
<h5>Database B <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Jose</span> <span class="uri">:manages</span> <span class="uri">:MyDepartment</span> ;
    <span class="uri">:is_supervisor_of</span> <span class="uri">:Maria</span> , <span class="uri">:Diego</span> .

<span class="uri">:Maria</span> <span class="uri">:works_in</span> <span class="uri">:MyDepartment</span> .

<span class="uri">:Diego</span> <span class="uri">:works_in</span> <span class="uri">:MyDepartment</span> .</code></pre>
<p>This constraint says that if an RDF instance <code>i</code> is related to <code>j</code> via
the property <code>manages</code> and <code>k</code> is related to <code>j</code> via the property
<code>works_in</code>, then <code>i</code> must be related to <code>k</code> via the property
<code>is_supervisor_of</code>. In  A, <code>Jose</code> is related to <code>MyDepartment</code>
via <code>manages</code>, <code>Diego</code> is related to <code>MyDepartment</code> via <code>works_in</code>, but
<code>Jose</code> is not related to <code>Diego</code> via any property, so A is
invalid. In B, <code>Jose</code> is related to <code>Maria</code> and <code>Diego</code>—who are both
related to <code>MyDepartment</code> by way of <code>works_in</code>—via the property
<code>is_supervisor_of</code>, so B is valid.</p>
<h3>Complex Constraints</h3>
<p>These constraints are more complex, often including multiple conditions.</p>
<h4>Employee Constraints</h4>
<p>Each employee either works on at least one project, supervises at least
one employee that works on at least one project, or manages at least one
department.</p>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="comment"># Constraint in Terp syntax:
</span><span class="comment"># :Employee rdfs:subClassOf (:works_on some (:Project or (:supervises some (:Employee and (:works_on some :Project))) or (:manages some :Department)))
</span>
<span class="uri">:Employee</span> <span class="uri">rdfs:subClassOf</span>
              [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                <span class="uri">owl:onProperty</span> <span class="uri">:works_on</span> ;
                <span class="uri">owl:someValuesFrom</span>
                        [ <span class="uri">owl:unionOf</span> (<span class="uri">:Project</span>
                                      [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                                        <span class="uri">owl:onProperty</span> <span class="uri">:supervises</span> ;
                                        <span class="uri">owl:someValuesFrom</span>
                                              [ <span class="uri">owl:intersectionOf</span> (<span class="uri">:Employee</span>
                                                                    [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                                                                      <span class="uri">owl:onProperty</span> <span class="uri">:works_on</span> ;
                                                                      <span class="uri">owl:someValuesFrom</span> <span class="uri">:Project</span>
                                                                    ])
                                              ]
                                      ]
                                      [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                                        <span class="uri">owl:onProperty</span> <span class="uri">:manages</span> ;
                                        <span class="uri">owl:someValuesFrom</span> <span class="uri">:Department</span>
                                      ])
                        ]
              ] .</code></pre>
<h5>Database A <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Esteban</span> <span class="uri">a</span> <span class="uri">:Employee</span> .</code></pre>
<h5>Database B <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Esteban</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:supervises</span> <span class="uri">:Lucinda</span> .

<span class="uri">:Lucinda</span> <span class="uri">a</span> <span class="uri">:Employee</span> .</code></pre>
<h5>Database C <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Esteban</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:supervises</span> <span class="uri">:Lucinda</span> .

<span class="uri">:Lucinda</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:works_on</span> <span class="uri">:MyProject</span> .

<span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> .</code></pre>
<h5>Database D <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Esteban</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:manages</span> <span class="uri">:MyDepartment</span> .

<span class="uri">:MyDepartment</span> <span class="uri">a</span> <span class="uri">:Department</span> .</code></pre>
<h5>Database E <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:Esteban</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:manages</span> <span class="uri">:MyDepartment</span> ;
    <span class="uri">:works_on</span> <span class="uri">:MyProject</span> .

<span class="uri">:MyDepartment</span> <span class="uri">a</span> <span class="uri">:Department</span> .

<span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> .</code></pre>
<p>This constraint says that if an individual <code>i</code> is an instance of
<code>Employee</code>, then at least one of three conditions must be met:</p>
<ul>
<li>it is related to an instance of <code>Project</code> via the property <code>works_on</code></li>
<li>it is related to an instance <code>j</code> via the property <code>supervises</code> and <code>j</code> is an instance of <code>Employee</code> and is also related to some instance of <code>Project</code> via the property <code>works_on</code></li>
<li>it is related to an instance of <code>Department</code> via the property <code>manages</code>.</li>
</ul>
<p>A and B are invalid because none of the conditions are met. C
meets the second condition: <code>Esteban</code> (who is an <code>Employee</code>) is related
to <code>Lucinda</code> via the property <code>supervises</code> whereas <code>Lucinda</code> is both an
<code>Employee</code> and related to <code>MyProject</code>, which is a <code>Project</code>, via the
property <code>works_on</code>. D meets the third condition: <code>Esteban</code> is related
to an instance of <code>Department</code>, namely <code>MyDepartment</code>, via the property
<code>manages</code>. Finally, E meets the first and the third conditions because
in addition to managing a department <code>Esteban</code> is also related an
instance of <code>Project</code>, namely <code>MyProject</code>, via the property <code>works_on</code></p>
<h4>Employees and US government funding</h4>
<p>Only employees who are American citizens can work on a project that
receives funds from a US government agency.</p>
<h5>Constraint</h5>
<pre class="highlighted"><code class="sparql"><span class="comment"># Constraint in Terp syntax:
</span><span class="comment"># :Project and (:receives_funds_from some :US_Government_Agency)) rdfs:subClassOf (inverse :works_on only (:Employee and (:nationality value "US")))
</span>
[ <span class="uri">owl:intersectionOf</span> (<span class="uri">:Project</span>
                       [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                         <span class="uri">owl:onProperty</span> <span class="uri">:receives_funds_from</span> ;
                         <span class="uri">owl:someValuesFrom</span> <span class="uri">:US_Government_Agency</span>
                       ]) .
] <span class="uri">rdfs:subClassOf</span>
              [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                <span class="uri">owl:onProperty</span> [<span class="uri">owl:inverseOf</span> <span class="uri">:works_on</span>] ;
                <span class="uri">owl:allValuesFrom</span> [ <span class="uri">owl:intersectionOf</span> (<span class="uri">:Employee</span>
                                                        [ <span class="uri">a</span> <span class="uri">owl:Restriction</span> ;
                                                          <span class="uri">owl:hasValue</span> <span class="string">"US"</span> ;
                                                          <span class="uri">owl:onProperty</span> <span class="uri">:nationality</span>
                                                        ])
                                  ]
              ] .</code></pre>
<h5>Database A <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> ;
    <span class="uri">:receives_funds_from</span> <span class="uri">:NASA</span> .

<span class="uri">:NASA</span> <span class="uri">a</span> <span class="uri">:US_Government_Agency</span></code></pre>
<h5>Database B <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> ;
    <span class="uri">:receives_funds_from</span> <span class="uri">:NASA</span> .

<span class="uri">:NASA</span> <span class="uri">a</span> <span class="uri">:US_Government_Agency</span> .

<span class="uri">:Andy</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:works_on</span> <span class="uri">:MyProject</span> .</code></pre>
<h5>Database C <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> ;
    <span class="uri">:receives_funds_from</span> <span class="uri">:NASA</span> .

<span class="uri">:NASA</span> <span class="uri">a</span> <span class="uri">:US_Government_Agency</span> .

<span class="uri">:Andy</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:works_on</span> <span class="uri">:MyProject</span> ;
    <span class="uri">:nationality</span> <span class="string">"US"</span> .</code></pre>
<h5>Database D <div class="metro danger label">INVALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> ;
    <span class="uri">:receives_funds_from</span> <span class="uri">:NASA</span> .

<span class="uri">:NASA</span> <span class="uri">a</span> <span class="uri">:US_Government_Agency</span> .

<span class="uri">:Andy</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:works_on</span> <span class="uri">:MyProject</span> ;
    <span class="uri">:nationality</span> <span class="string">"US"</span> .

<span class="uri">:Heidi</span> <span class="uri">a</span> <span class="uri">:Supervisor</span> ;
    <span class="uri">:works_on</span> <span class="uri">:MyProject</span> ;
    <span class="uri">:nationality</span> <span class="string">"US"</span> .</code></pre>
<h5>Database E <div class="metro success label">VALID</div></h5>
<pre class="highlighted"><code class="sparql"><span class="uri">:MyProject</span> <span class="uri">a</span> <span class="uri">:Project</span> ;
    <span class="uri">:receives_funds_from</span> <span class="uri">:NASA</span> .

<span class="uri">:NASA</span> <span class="uri">a</span> <span class="uri">:US_Government_Agency</span> .

<span class="uri">:Andy</span> <span class="uri">a</span> <span class="uri">:Employee</span> ;
    <span class="uri">:works_on</span> <span class="uri">:MyProject</span> ;
    <span class="uri">:nationality</span> <span class="string">"US"</span> .

<span class="uri">:Heidi</span> <span class="uri">a</span> <span class="uri">:Supervisor</span> ;
    <span class="uri">:works_on</span> <span class="uri">:MyProject</span> ;
    <span class="uri">:nationality</span> <span class="string">"US"</span> .

<span class="uri">:Supervisor</span> <span class="uri">rdfs:subClassOf</span> <span class="uri">:Employee</span> .
    SubClassOf: Employee</code></pre>
<p>This constraint says that if an individual <code>i</code> is an instance of
<code>Project</code> and is related to an instance of <code>US_Government_Agency</code> via
the property <code>receives_funds_from</code>, then any individual <code>j</code> which is
related to <code>i</code> via the property <code>works_on</code> must satisfy two conditions:</p>
<ul>
<li>it must be an instance of <code>Employee</code></li>
<li>it must not be related to any literal other than <code>"US"</code> via the data property <code>nationality</code>.</li>
</ul>
<p>A is valid because there is no individual related to
<code>MyProject</code> via <code>works_on</code>, so the constraint is trivially satisfied.
B is invalid since <code>Andy</code> is related to <code>MyProject</code> via
<code>works_on</code>, <code>MyProject</code> is an instance of <code>Project</code> and is related to
an instance of <code>US_Government_Agency</code>, that is, <code>NASA</code>, via
<code>receives_funds_from</code>, but <code>Andy</code> does not have any data property
assertions. C is valid because both conditions are met. D is not valid
because <code>Heidi</code> violated the first condition: she is related to
<code>MyProject</code> via <code>works_on</code> but is not known to be an instance of
<code>Employee</code>. Finally, this is fixed in E—by way of a handy OWL
axiom—which states that every instance of <code>Supervisor</code> is an
instance of <code>Employee</code>, so <code>Heidi</code> is inferred to be an
instance of <code>Employee</code> and, consequently, E is valid.</p>
<p>If you made it this far, you deserve a drink!</p>
<h2 id="sd-Explaining-ICV-Violations">Explaining ICV Violations</h2>
<p>ICV violations can be explained using <a href="../owl2#sd-Proof-Trees">proof trees</a>
similar to inferences. The following command will explain the IC violations
for constraints stored in the database:</p>
<pre class="highlighted"><code class="bash">$ stardog icv explain --reasoning EL <span class="string">"myDB"</span></code></pre>
<p>It is possible to explain violations for external constraints by passing the
file with constraints as an additional argument:</p>
<pre class="highlighted"><code class="bash">$ stardog icv explain --reasoning EL <span class="string">"myDB"</span> constraints.ttl</code></pre>
<h2 id="sd-Using-ICV-Programmatically">Using ICV Programmatically</h2>
<p>This section will describe how to use Stardog ICV via the SNARL APIs. For
more information on using SNARL in general, please refer to the
section on <a href="../java">programming with Stardog in Java</a>.</p>
<p>There is command-line interface support for many of the operations
necessary to using ICV with a Stardog database; please see the
<a href="../admin">Administration</a> chapter for that documentation.</p>
<p>To use ICV in Stardog, one must:</p>
<ol>
<li>create some constraints</li>
<li>associate those constraints with a Stardog database</li>
</ol>
<h3>Creating Constraints</h3>
<p><a href="../java/snarl/com/complexible/stardog/icv/Constraint.html"><code>Constraints</code></a>
can be created using the
<a href="../java/snarl/com/complexible/stardog/icv/ConstraintFactory.html"><code>ConstraintFactory</code></a>
which provides methods for creating integrity constraints from OWL
axioms or from SPARQL select queries. <code>ConstraintFactory</code> expects your
constraints, if they are defined as OWL axioms, as an RDF triple (or
graph). To aid in authoring constraints in OWL,
<a href="../java/snarl/com/complexible/common/openrdf/util/ExpressionFactory.html"><code>ExpressionFactory</code></a>
is provided for building the <a href="http://www.w3.org/TR/owl2-mapping-to-rdf/">RDF
equivalent</a> of the OWL axioms
of your constraint.</p>
<p>You can also write your constraints in OWL in your favorite editor and load them into the database from your OWL file.</p>
<p>We recommend defining your constraints as OWL axioms, but you are free
to define them using SPARQL <code>SELECT</code> queries. If you choose to define a
constraint using a SPARQL <code>SELECT</code> query, please keep in mind that if your
query returns results, those are interpreted as the violations of the
integrity constraint.</p>
<p>An example of creating a simple constraint using <code>ExpressionFactory</code>:</p>
<script src="https://gist.github.com/1333767.js?file=CreateConstraint.java"></script>

<h3>Adding Constraints to Stardog</h3>
<p>The <a href="../java/snarl/com/complexible/stardog/icv/api/ICVConnection.html">ICVConnection</a> interface provides programmatic access to the ICV support in Stardog.
It provides support for adding, removing and clearing integrity constraints in
your database as well as methods for checking whether or not the data is
valid; and when it's not, retrieving the list of violations.</p>
<p>This example shows how to add an integrity constraint to a Stardog
database.</p>
<script src="https://gist.github.com/1333767.js?file=AddConstraint.java"></script>

<p>Here we show how to add a set of constraints as defined in a local OWL
ontology.</p>
<script src="https://gist.github.com/1333767.js?file=AddConstraint2.java"></script>


<h3>IC Validation</h3>
<p>Checking whether or not the contents of a database are valid is easy. Once you have an
<a href="../java/snarl/com/complexible/stardog/icv/api/ICVConnection.html"><code>ICVConnection</code></a>
you can simply call its
<a href="../java/snarl/com/complexible/stardog/icv/api/ICVConnection.html#isValid()"><code>isValid()</code></a>
method which will return whether or not the contents of the database are
valid with respect to the constraints associated with that database.
Similarly, you can provide some
<a href="../java/snarl/com/complexible/stardog/icv/Constraint.html"><code>constraints</code></a>
to the <code>isValid()</code> method to see if the data in the database is invalid
for those <code>specific</code> constraints; which can be a subset of the
constraints associated with the database, or they can be new constraints
you are working on.</p>
<p>If the data is invalid for some constraints—either the explicit
constraints in your database or a new set of constraints you have
authored—you can get some information about what the violation was from
the SNARL IC Connection.
<a href="../java/snarl/com/complexible/stardog/icv/api/ICVConnection.html#getViolationBindings()"><code>ICVConnection.getViolationBindings()</code></a>
will return the constraints which are violated, and for each constraint,
you can get the violations as the set of bindings that satisfied the
constraint query. You can turn the bindings into the individuals which
are in the violation using
<a href="../java/snarl/com/complexible/stardog/icv/ICV.html#asIndividuals()"><code>ICV.asIndividuals()</code></a>.</p>
<h3>ICV and Transactions</h3>
<p>In addition to using the ICConnection a data oracle to tell whether or
not your data is valid with respect to some constraints, you can also
use Stardog's ICV support to protect your database from invalid data by
using ICV as a guard within transactions.</p>
<p>When guard mode for ICV is enabled in Stardog, each commit is inspected
to ensure that the contents of the database are valid for the set of
constraints that have been associated with it. Should someone attempt to
commit data which violates one or more of the constraints defined for
the database, the commit will fail and the data will not be
added/removed from your database.</p>
<p>By default, reasoning is not used when you enable guard mode, however
you are free to specify any of the reasoning types supported by Stardog
when enabling guard mode. If you have provided a specific reasoning type
for guard mode it will be used during validation of the integrity
constraints. This means you can author your constraints with the
expectation of inference results satisfying a constraint.</p>
<script src="https://gist.github.com/1333782.js?file=CreateDiskAndICV.java"></script>

<p>This illustrates how to create a persistent disk database with ICV guard
mode enabled at the QL reasoning type. Guard mode can also be enabled
when the database is created on the <a href="../admin">command line</a></p>
<h2 id="sd-Terminology">Terminology</h2>
<p>This chapter may be easier for you to
understand if you read this section on terminology a few times.</p>
<h3>ICV, Integrity Constraint Validation</h3>
<p>The process of checking whether some Stardog database is valid with
respect to some integrity constraints. The result of ICV is a boolean
value (true if valid, false if invalid) and, optionally, an <code>explanation
of constraint violations</code>.</p>
<h3>Schema, TBox</h3>
<p>A schema (or “terminology box” a.k.a., TBox) is a set of statements that
define the relationships between data elements, including property and
class names, their relationships, etc. In practical terms, schema
statements for a Stardog database are RDF Schema and OWL 2 terms,
axioms, and definitions.</p>
<h3>Data, ABox</h3>
<p>All of the triples in a Stardog database that aren't part of the schema
are part of the data (or “assertional box” a.k.a. ABox).</p>
<h3>Integrity Constraint</h3>
<p>A declarative expression of some rule or constraint which data must
conform to in order to be valid. Integrity Constraints are typically
domain and application specific. They can be expressed in OWL 2 (any
legal syntax), SWRL rules, or (a restricted form of) SPARQL queries.</p>
<h3>Constraints</h3>
<p>Constraints that have been associated with a Stardog database and which
are used to validate the data it contains. Each Stardog may optionally
have one and only one set of constraints associated with it.</p>
<h3>Closed World Assumption, Closed World Reasoning</h3>
<p>Stardog ICV assumes a closed world with respect to data and constraints:
that is, it assumes that all relevant data is known to it and included
in a database to be validated. It interprets the meaning of Integrity
Constraints in light of this assumption; if a constraint says a value
<code>must</code> be present, the absence of that value is interpreted as a
constraint violation and, hence, as invalid data.</p>
<h3>Open World Assumption, Open World Reasoning</h3>
<p>A legal OWL 2 inference may violate or satisfy an Integrity Constraint
in Stardog. In other words, you get to have your cake (OWL as a
constraint language) and eat it, too (OWL as modeling or inference
language). This means that constraints are applied to a Stardog database
<code>with respect to an OWL 2 profile</code>.</p>
<h3>Monotonicity</h3>
<p>OWL is a monotonic language: that means you can never <code>add</code> anything to a
Stardog database that causes there to be <code>fewer</code> legal inferences. Or, put
another way, the only way to decrease the number of legal inferences is
to <code>delete</code> something.</p>
<p>Monotonicity interacts with ICV in the following ways:</p>
<ol>
<li>Adding data to or removing it from a Stardog database may make it
invalid.</li>
<li>Adding schema statements to or removing them from a Stardog database
may make it invalid.</li>
<li>Adding new constraints to a Stardog database may make it invalid.</li>
<li>Deleting constraints from a Stardog database <code>cannot make it
invalid</code>.</li>
</ol>

          </div>
          <div class="" id="footnote-container" style="display: block;">
            <h2>Notes</h2>
          <div class="footnote" id="footnote-1"><p>1. The standard inference semantics of OWL 2 do not adopt the unique name assumption because, in information integration scenarios, things often have more than one name but that doesn‘t mean they are different things. For example, when several databases or other data sources all contain some partial information about, say, an employee, but they each name or identify the employee in different ways. OWL 2 won’t assume these are different employees just because there are several names.<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-1">&nbsp;&#8618;</a></p></div><div class="footnote" id="footnote-2"><p>2. Strictly speaking, this is a bit misleading. Stardog ICV actually uses both open and closed world semantics: since inferences can violate or satisfy constraints, and Stardog uses open world semantics to calculate inferences, then the ICV process is compatible with open world reasoning, to which it then applies a form of closed world validation, as described in this chapter. Relax: we&#39;re experts and this stuff <em>works</em>!<a class="skip fn-marker" gumby-easing="easeOutQuad" gumby-duration="400" gumby-goto="#fn-ref-2">&nbsp;&#8618;</a></p></div></div>
        </div>
    </div>
  </div>
</div>


<div class="wrapper shaded" id="subfoot">
      <section class="row">
        <div class="twelve columns">
            <div class="four columns">
              <a style="text-decoration: none; border-bottom: 0;" href="http://clarkparsia.com/"><img id="footer-logo" style="max-width: 50%;" src="/img/cp.png"></a>
              <div> </div>
              <!-- follow us on Twitter -->
            </div>
            <div class="eight columns">
              
                <h4>This is <span id="footer-subhead">Integrity Constraint Validation</span>, part of <a href="http://docs.stardog.com/">Stardog Docs</a> 2.2.</h4>
              
              <p class="copywood">For comments, questions, or to report problems with this page, visit the <a href="https://groups.google.com/a/clarkparsia.com/group/stardog/about">Stardog Support Forum</a>.</p>
              <p class="copywood">&copy;2010&ndash;2014 Clark &amp; Parsia LLC. <a href="http://creativecommons.org/licenses/by-sa/3.0/">Some rights reserved</a>.
            </p></div>
        </div>
      </section>
</div>

<script defer="defer" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script defer="defer" src="/js/libs/gumby.js"></script><script defer="defer" src="/js/libs/ui/gumby.fittext.js"></script><script defer="defer" src="/js/libs/ui/gumby.fixed.js"></script><script defer="defer" src="/js/libs/ui/gumby.navbar.js"></script><script defer="defer" src="/js/libs/ui/gumby.retina.js"></script><script defer="defer" src="/js/libs/ui/gumby.skiplink.js"></script><script defer="defer" src="/js/libs/ui/gumby.tabs.js"></script><script defer="defer" src="/js/libs/ui/gumby.toggleswitch.js"></script><script defer="defer" src="/js/libs/gumby.init.js"></script><script defer="defer" src="/js/plugins.js"></script><script defer="defer" src="/js/main.js"></script>

</body>

</html>